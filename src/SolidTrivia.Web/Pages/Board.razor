@page "/board/{SessionId}"
@using SolidTrivia.Web.Components;
@inject NavigationManager NavigationManager
@inject SolidTrivia.Game.ISolidTrivia SolidTrivia

<div class="board-wrapper">
    @foreach (var category in Session.Categories)
    {
        <div class="board-column">
            <div>@category.Title</div>
            @foreach (var prompt in category.Prompts)
            {
                <div class="@HiddenPrompt(prompt.IsAnswered)" @onclick="() => NavigateToPrompt(prompt)">$@(prompt.Weight * 100)</div>
            }
        </div>
    }
</div>
<CascadingValue Value="@Session" Name="Session">
    <LeaderboardComponent />
</CascadingValue>

@code {
    [Parameter]
    public string SessionId { get; set; }

    private SolidTrivia.Game.GameSession Session { get; set; }

    private string HiddenPrompt(bool isAnswered) => isAnswered ? "answered" : "";

    protected override void OnInitialized()
    {
        Session = SolidTrivia.GetSessionById(SessionId);
        Session.PropertyChanged += (o, e) => base.InvokeAsync(StateHasChanged);
    }

    private void NavigateToPrompt(SolidTrivia.Game.Models.IPrompt prompt)
    {
        if (Session.IsPromptInProgress())
        {
            //todo: some kind of error?
            NavigationManager.NavigateTo($"Board/{SessionId}/Prompt/{Session.CurrentPrompt().Id}");
        }
        else
        {
            Session.SelectPrompt(prompt);
            NavigationManager.NavigateTo($"Board/{SessionId}/Prompt/{prompt.Id}");
        }
    }
}